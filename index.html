<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8">
  <title>Каталог одежды</title>
  <style>
    body { font-family: Arial, sans-serif; margin: 20px; }
    .form-group { margin-bottom: 10px; }
    .catalog-item { border: 1px solid #ccc; padding: 10px; margin-bottom: 10px; }
    .catalog-photo { max-width: 100px; max-height: 100px; object-fit: cover; margin-right: 5px; }
    .photo-container { display: flex; flex-wrap: wrap; gap: 5px; margin-top: 5px; }
  </style>
</head>
<body>
  <h1>Добавить одежду</h1>
  <form id="productForm">
    <div class="form-group">
      <label>Название: <input type="text" name="name" required></label>
    </div>
    <div class="form-group">
      <label>Цена: <input type="number" name="price" required></label>
    </div>
    <div class="form-group">
      <label>Размер:
        <select name="size" required>
          <option value="">Выберите размер</option>
          <option value="XS">XS</option>
          <option value="S">S</option>
          <option value="M">M</option>
          <option value="L">L</option>
          <option value="XL">XL</option>
        </select>
      </label>
    </div>
    <div class="form-group">
      <label>Город:
        <select id="citySelect">
          <option value="">Выберите город</option>
          <option value="Москва">Москва</option>
          <option value="Санкт-Петербург">Санкт-Петербург</option>
        </select>
      </label>
      <br>
      <label>или введите свой: <input type="text" id="cityInput" placeholder="Другой город"></label>
    </div>
    <div class="form-group">
      <label>Телефон продавца: <input type="tel" name="phone" required></label>
    </div>
    <div class="form-group">
      <label>Фото (до 3): <input type="file" id="photos" accept="image/*" multiple></label>
    </div>
    <button type="submit">Добавить</button>
  </form>

  <h2>Каталог</h2>
  <div>
    <label>Фильтр по городу:
      <select id="filterCity">
        <option value="">Все города</option>
        <option value="Москва">Москва</option>
        <option value="Санкт-Петербург">Санкт-Петербург</option>
      </select>
    </label>
    <label>Фильтр по размеру:
      <select id="filterSize">
        <option value="">Все размеры</option>
        <option value="XS">XS</option>
        <option value="S">S</option>
        <option value="M">M</option>
        <option value="L">L</option>
        <option value="XL">XL</option>
      </select>
    </label>
  </div>
  <div id="catalog"></div>

  <script>
    const productForm = document.getElementById('productForm');
    const photosInput = document.getElementById('photos');
    const citySelect = document.getElementById('citySelect');
    const cityInput = document.getElementById('cityInput');
    const filterCity = document.getElementById('filterCity');
    const filterSize = document.getElementById('filterSize');
    const catalog = document.getElementById('catalog');

    let products = JSON.parse(localStorage.getItem('products')) || [];

    productForm.addEventListener('submit', async e => {
      e.preventDefault();

      let city = cityInput.value.trim() || citySelect.value.trim();
      if (!city) {
        alert('Пожалуйста, укажите город (выберите или введите вручную)');
        return;
      }

      if (!productForm.phone.value.trim()) {
        alert('Пожалуйста, укажите телефон продавца');
        return;
      }

      const files = photosInput.files;
      if (files.length > 3) {
        alert('Можно загрузить максимум 3 фото');
        return;
      }

      const photosData = [];
      for (let i = 0; i < files.length; i++) {
        photosData.push(await readFileAsDataURL(files[i]));
      }

      const newProduct = {
        name: productForm.name.value.trim(),
        price: parseFloat(productForm.price.value).toFixed(2),
        size: productForm.size.value.trim(),
        city: city,
        phone: productForm.phone.value.trim(),
        photos: photosData,
      };

      products.push(newProduct);
      localStorage.setItem('products', JSON.stringify(products));
      renderCatalog();

      productForm.reset();
      cityInput.value = '';
      citySelect.value = '';
      photosInput.value = null;
    });

    function renderCatalog() {
      catalog.innerHTML = '';

      const selectedCity = filterCity.value;
      const selectedSize = filterSize.value;

      const filtered = products.filter(product => {
        return (!selectedCity || product.city === selectedCity) &&
               (!selectedSize || product.size === selectedSize);
      });

      filtered.forEach(product => {
        const div = document.createElement('div');
        div.className = 'catalog-item';
        div.innerHTML = `
          <strong>${product.name}</strong> — ${product.price} руб.<br>
          Размер: ${product.size}<br>
          Город: ${product.city}<br>
          Телефон: ${product.phone}
        `;
        if (product.photos && product.photos.length > 0) {
          const photoContainer = document.createElement('div');
          photoContainer.className = 'photo-container';
          product.photos.forEach(photo => {
            const img = document.createElement('img');
            img.src = photo;
            img.className = 'catalog-photo';
            photoContainer.appendChild(img);
          });
          div.appendChild(photoContainer);
        }
        catalog.appendChild(div);
      });
    }

    function readFileAsDataURL(file) {
      return new Promise(resolve => {
        const reader = new FileReader();
        reader.onload = e => resolve(e.target.result);
        reader.readAsDataURL(file);
      });
    }

    filterCity.addEventListener('change', renderCatalog);
    filterSize.addEventListener('change', renderCatalog);

    renderCatalog(); // загрузка при старте
  </script>
</body>
</html>

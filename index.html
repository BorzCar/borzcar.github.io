<!DOCTYPE html>
<html lang="ru">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>BorzWear Каталог с фото</title>
<style>
  body { font-family: Arial, sans-serif; max-width: 900px; margin: 20px auto; padding: 0 10px; }
  form { background: #f9f9f9; padding: 15px; border-radius: 6px; margin-bottom: 30px; }
  label { display: block; margin-bottom: 10px; }
  input, select, button { width: 100%; padding: 8px; font-size: 16px; margin-top: 4px; box-sizing: border-box; }
  #contactPhone, #contactEmail { margin-top: 10px; }
  .product {
    border: 1px solid #ccc; border-radius: 6px; background: #fff; padding: 10px;
    margin-bottom: 15px; display: flex; align-items: center; cursor: pointer;
  }
  .product img {
    width: 80px; height: 80px; object-fit: cover; border-radius: 4px; margin-right: 15px;
  }
  .product-info { flex-grow: 1; }
  .product-info h3 { margin: 0 0 6px 0; font-size: 20px; }
  .contact { font-weight: bold; margin-top: 6px; }
  
  /* Модальное окно */
  #modal {
    display: none; position: fixed; top:0; left:0; width: 100%; height: 100%;
    background: rgba(0,0,0,0.7); justify-content: center; align-items: center;
    z-index: 9999;
  }
  #modal-content {
    position: relative; background: #fff; padding: 20px; max-width: 600px; width: 90%;
    border-radius: 8px;
    text-align: center;
  }
  #modal img {
    max-width: 100%; max-height: 400px; border-radius: 6px;
  }
  #modal-close {
    position: absolute; top: 10px; right: 10px; font-size: 24px;
    cursor: pointer; user-select: none;
  }
  #modal-prev, #modal-next {
    cursor: pointer; font-size: 30px; user-select: none; color: #333; 
    position: absolute; top: 50%; transform: translateY(-50%);
    background: rgba(255,255,255,0.7); padding: 5px 10px; border-radius: 4px;
  }
  #modal-prev { left: 10px; }
  #modal-next { right: 10px; }
</style>
</head>
<body>

<h1>Добавить товар в каталог BorzWear</h1>
<form id="sellForm">
  <label>
    Название товара:
    <input type="text" name="productName" required />
  </label>

  <label>
    Цена (€):
    <input type="number" name="price" required min="0" />
  </label>

  <label>
    Город:
    <select name="city" required>
      <option value="">Выберите город</option>
      <option value="Angers">Angers</option>
      <option value="Bordeaux">Bordeaux</option>
      <option value="Clermont-Ferrand">Clermont-Ferrand</option>
      <option value="Dijon">Dijon</option>
      <option value="Grenoble">Grenoble</option>
      <option value="Lille">Lille</option>
      <option value="Lyon">Lyon</option>
      <option value="Marseille">Marseille</option>
      <option value="Montpellier">Montpellier</option>
      <option value="Nantes">Nantes</option>
      <option value="Nice">Nice</option>
      <option value="Nîmes">Nîmes</option>
      <option value="Paris">Paris</option>
      <option value="Reims">Reims</option>
      <option value="Rennes">Rennes</option>
      <option value="Saint-Étienne">Saint-Étienne</option>
      <option value="Strasbourg">Strasbourg</option>
      <option value="Toulon">Toulon</option>
      <option value="Toulouse">Toulouse</option>
      <option value="Valenciennes">Valenciennes</option>
    </select>
  </label>

  <label>
    Способ связи:
    <select id="contactMethod" name="contactMethod" required onchange="toggleContactInput()">
      <option value="">Выберите</option>
      <option value="phone">Телефон</option>
      <option value="email">Email</option>
    </select>
  </label>

  <div id="contactPhone" style="display:none;">
    <label>
      Введите телефон:
      <input type="tel" name="phone" />
    </label>
  </div>

  <div id="contactEmail" style="display:none;">
    <label>
      Введите email:
      <input type="email" name="email" />
    </label>
  </div>

  <label>
    Фото товара (максимум 3):
    <input type="file" name="photos" accept="image/*" multiple />
  </label>

  <button type="submit">Добавить в каталог</button>
</form>

<h2>Каталог товаров</h2>
<div id="catalog"></div>

<!-- Модальное окно -->
<div id="modal">
  <div id="modal-content">
    <span id="modal-close">&times;</span>
    <img id="modal-image" src="" alt="Фото товара" />
    <span id="modal-prev">&#10094;</span>
    <span id="modal-next">&#10095;</span>
    <div id="modal-caption"></div>
  </div>
</div>

<script>
function toggleContactInput() {
  const method = document.getElementById('contactMethod').value;
  document.getElementById('contactPhone').style.display = method === 'phone' ? 'block' : 'none';
  document.getElementById('contactEmail').style.display = method === 'email' ? 'block' : 'none';
}

let catalog = [];
const catalogDiv = document.getElementById('catalog');

function renderCatalog() {
  catalogDiv.innerHTML = '';
  if (catalog.length === 0) {
    catalogDiv.innerHTML = '<p>Каталог пуст.</p>';
    return;
  }
  catalog.forEach((item, index) => {
    const div = document.createElement('div');
    div.className = 'product';
    div.dataset.index = index;

    const imgSrc = item.photos.length > 0 ? item.photos[0] : '';
    const img = document.createElement('img');
    img.src = imgSrc || 'https://via.placeholder.com/80x80?text=Фото';
    img.alt = item.productName;

    const info = document.createElement('div');
    info.className = 'product-info';
    info.innerHTML = `
      <h3>${item.productName}</h3>
      <div>Цена: €${item.price}</div>
      <div>Город: ${item.city}</div>
      <div class="contact">Связь: ${item.contactMethod === 'phone' ? 'Телефон: ' + item.phone : 'Email: ' + item.email}</div>
    `;

    div.appendChild(img);
    div.appendChild(info);

    div.addEventListener('click', () => openModal(index));

    catalogDiv.appendChild(div);
  });
}

function openModal(index) {
  currentModalIndex = index;
  showModalImage();
  modal.style.display = 'flex';
}

function closeModal() {
  modal.style.display = 'none';
}

function showModalImage() {
  const item = catalog[currentModalIndex];
  modalImage.src = item.photos[currentPhotoIndex];
  modalCaption.textContent = `${item.productName} (${currentPhotoIndex + 1} / ${item.photos.length})`;
}

function prevPhoto() {
  if (catalog.length === 0) return;
  const item = catalog[currentModalIndex];
  currentPhotoIndex = (currentPhotoIndex - 1 + item.photos.length) % item.photos.length;
  showModalImage();
}

function nextPhoto() {
  if (catalog.length === 0) return;
  const item = catalog[currentModalIndex];
  currentPhotoIndex = (currentPhotoIndex + 1) % item.photos.length;
  showModalImage();
}

function loadCatalogFromStorage() {
  const stored = localStorage.getItem('borzwearCatalogPhotos');
  catalog = stored ? JSON.parse(stored) : [];
}

function saveCatalogToStorage() {
  localStorage.setItem('borzwearCatalogPhotos', JSON.stringify(catalog));
}

document.getElementById('sellForm').addEventListener('submit', function(e) {
  e.preventDefault();
  const form = e.target;

  const productName = form.productName.value.trim();
  const price = parseFloat(form.price.value);
  const city = form.city.value;
  const contactMethod = form.contactMethod.value;
  const phone = form.phone.value.trim();
  const email = form.email.value.trim();
  const photosInput = form.photos;

  if (!productName || isNaN(price) || !city || !contactMethod) {
    alert('Пожалуйста, заполните все обязательные поля');
    return;
  }
  if (contactMethod === 'phone' && !phone) {
    alert('Введите телефон');
    return;
  }
  if (contactMethod === 'email' && !email) {
    alert('Введите email');
    return;
  }

  const files = photosInput.files;
  if (files.length === 0) {
    alert('Добавьте хотя бы одну фотографию');
    return;
  }
  if (files.length > 3) {
    alert('Максимум 3 фотографии');
    return;
  }

  const photosBase64 = [];

  let filesProcessed = 0;

  for (let i = 0; i < files.length; i++) {
    const file = files[i];
    const reader = new FileReader();
    reader.onload = function(event) {
      photosBase64.push(event.target.result);
      filesProcessed++;
      if (filesProcessed === files.length) {
        // Добавляем товар после загрузки всех фото
        const newItem = {
          productName,
          price,
          city,
          contactMethod,
          phone,
          email,
          photos: photosBase64
        };
        catalog.push(newItem);
        saveCatalogToStorage();
        renderCatalog();
        form.reset();
        toggleContactInput();
      }
    }
    reader.readAsDataURL(file);
  }
});

// Модальное окно
const modal = document.getElementById('modal');
const modalClose = document.getElementById('modal-close');
const modalImage = document.getElementById('modal-image');
const modalCaption = document.getElementById('modal-caption');
const modalPrev = document.getElementById('modal-prev');
const modalNext = document.getElementById('modal-next');

let currentModalIndex = 0;
let currentPhotoIndex = 0;

modalClose.onclick = () => closeModal();
modalPrev.onclick = () => { prevPhoto(); };
modalNext.onclick = () => { nextPhoto(); };
modal.onclick = (e) => {
  if (e.target === modal) closeModal();
};

loadCatalogFromStorage();
renderCatalog();
toggleContactInput();
</script>

</body>
</html>
